{% extends "university/university.html" %}

{% block java_script %}

	<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyAVhEUFDeVH_RZKiww16p2NC4afR5O70to&sensor=false"></script>
	
	<!--Llamamos a la API de Google Maps-->
	<!--<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>-->

	<!--Plugin GMaps-->
	<script type="text/javascript" src="/static/js/gmaps.js"></script>

	<script type="text/javascript">


//    var objPlaces = new Array();
//    for (var j=0; j<{{misPuntos}}.length; j++){
//        for (var k=0; k<{{misPuntos}}[j].length; k++){
//            objPlaces[j][k].push({{misPuntos}}[j][k]);
//        }      
//    }   
    

    function setGoogleMarkers(map, places){
        
        var titles = new Array({{longitud}});
        var markers = [];
        
        console.log(titles.length); //Longitud es dos, que son el número de residencias de la tabla de la DB
        console.log("Longitud places: ");
        console.log(places.length);
        console.log(places);

       
            var j=0;
            var k=0;
            
            while((k < ({{longitud}}*3)) && (j<{{longitud}})){
            
                //for (i in places){
                    
                    console.log('places[k]');
                             
                    console.log(k);
                    console.log(j);
                    titles[j] = places[k];
                    console.log("$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$");
                    console.log(titles[j]);
                    console.log('HOLAAAAAAAAAAAAAAAAAAAAAAAaaa');
                    markers[j] = new google.maps.Marker({
                        position: new google.maps.LatLng(places[k+1], places[k+2]),
                        map: map,
                        icon: 'http://gmaps-samples.googlecode.com/svn/trunk/markers/green/blank.png',
                        zIndex: 2,
                        draggable: false,
                        title: places[k]}
                    );
                    
                    console.log("elemento markers completado");
                    
                    
                    //console.log(places[k]);
                    //titles[j].push('places[k]')
                    
                    //console.log('titles[j]');
                    //console.log(titles[j]);
                    //j = j+1;
                    /*google.maps.event.addListener(marker, 'mouseup', function(){
                        var popup = new google.maps.InfoWindow();
                        var note = title;
                        
                        popup.setContent(note);
                        popup.open(map, marker);
                    });*/
                    
                    google.maps.event.addListener(markers[j], "click", function(){
                        console.log("Ha hecho click");
                        var popup = new google.maps.InfoWindow(titles[j]);
                        //var note = titles[j];
                        
                        //popup.setContent(titles[j]);
                        popup.open(map, markers[j]);
                        
                    });
                    
                    console.log(titles[j]);
                    console.log(k);
                    console.log(j);
                    k=k+3;
                    j=j+1;
                    console.log(k);
                    console.log(j);                   
                //};//for
            /*for (i in places){
                console.log(places[i]);
                
                markers[i] = new google.maps.Marker({
                    position: new google.maps.LatLng(places[i][1], places[i][2]),
                    map: map,
                    icon: 'http://gmaps-samples.googlecode.com/svn/trunk/markers/green/blank.png',
                    title: places[i][0]});
                console.log("elemento markers completado");
                
                var j=0;
                titles[j] = places[i][0];
                console.log(titles[j])
                };  */
    
        }; //while
    };//function

    function initialize(){
        
        var options = {
            zoom: 10,
            center: new google.maps.LatLng({{uni.latitud}}, {{uni.longitud}}),
            mapTypeId: google.maps.MapTypeId.ROADMAP};
            
        var marker = new google.maps.Marker({
                position: new google.maps.LatLng({{uni.latitud}}, {{uni.longitud}}),
                // icon: 'http://gmaps-samples.googlecode.com/svn/trunk/markers/blue/blank.png',
                // True para desplazar el icono               
                draggable: false, 
                zIndex : 14, //En caso de haber dos iconos cerca, que éste resalte más
                title: '{{uniname}}'});
                
        var infoWindow = new google.maps.InfoWindow({content: '{{uniname}}'});
        
        var map = new google.maps.Map(document.getElementById("googleMap"), options, marker, infoWindow);
        marker.setMap(map);
        
        console.log("hola");
        
        //console.log({{mispuntos|safe}});
        //var array = {{mispuntos}};
        /*var places = [];
        for (var i=0; i<{{longitud}}; i++){
            for (var l=0; l<3;l++){
                console.log(datos[l]);
            };
            
            //console.log(datos[i]);
            console.log(i);
        };
        
        /*for (i=0;i<{{mispuntos}}.length;i++){ 
           	
           	for (j=0;j<array[i].length;j++){ 
              	 console.log(array[i].[j]);
           	} 
          
        } */
 
        //setGoogleMarkers(map, {{mispuntos|safe}});
        setGoogleMarkers(map, datos);
        infoWindow.open(map, marker);
        
    };

    google.maps.event.addDomListener(window, 'load', initialize);
	</script>

{% endblock %}


{% block pathimage %}
  <img src ="/tuerasmus/media/{{path_image}}" width="300px" heigth="300px"/>
{% endblock %}

{% block on_georesidence %}
	
  <div class="page-header">
    <h1><a href="/tuerasmus/university/{{uni_name}}" style="color: #424242">{{ uniname }}</a></h1>
    <h6>Pincha sobre el nombre de la universidad para ir al perfil de la universidad</h6>
  </div>
  
	<div class="row">

    {% if list_empty %}
      <h3><center>No hay residencias registradas para esta universidad</center></h3>
    {% else %} 
    

      <div class="row">
		    <div class="col-xs-9">
			    <div id="googleMap" style="width:700px;height:500px;">
			    
			      <script type="text/javascript">
			        var datos = [];
			        var m = 0;
			        {% for i in mispuntos %}
			            {% for k in i %}
			              
			              
			                  console.log("GGGGGGGGGGGG");
			                  console.log('{{k}}');
                        
                        
                        datos.push('{{ k }}');
              
                        
                   
            
                  {% endfor %}
                  m = m + 1;
			        {% endfor %}
			      </script>
			    </div>
		    </div>

      </div><!--/.row -->
    
      <div class="row">

          <div class="page-header">
            <h2>Para conocer más sobre <a href="/tuerasmus/universities/residences" style="color: #424242">las residencias</a></h2>
          </div>      
      
		      {% for i in info_list %}
		        
			      <div class="row">
				      <div class="col-xs-6">
					      <h3>{{i.id}}. {{i.name}}</h3>
					      <address>
                  <h4>
                    {{i.address}}<br>
                    {{i.postalcode}}<br>
                    {{i.city}}<br>
                    <!--{{i.country}}<br>
                  <abbr title="Phone">Tlf de contacto: </abbr> (+{{i.prefix}}) {{i.phone}}<br>-->
                  </h4>
					      </address>
				      </div>
			      </div>
			      
		      {% endfor %}
		      
		      
      </div><!--/.row -->
		{% endif %}
		
	</div><!--/.row-->

{% endblock %}

